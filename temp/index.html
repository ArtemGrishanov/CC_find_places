<!DOCTYPE html>
<html>
<head>
    <title></title>
    <style>
        .map {
            position: absolute;
            top: 0;
            left: 0;
            background: url("../assets/map_950.png");
            width: 950px;
            height: 480px;
        }
        .pointer {
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 5px;
            background: #000;
        }
        .container {
            position: relative;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="map"></div>
        <div id="id-pointer" class="pointer"></div>
    </div>
    <script>
        var cities = [],
            mapHeight = 480;//1026,
            mapWidth = 950;//1400,
            zeroMeridianY = 656;

        function init() {
            var xmlhttp = new XMLHttpRequest();
            xmlhttp.onreadystatechange = function()
            {
                if (xmlhttp.readyState==4 && xmlhttp.status==200)
                {
                    var lines = xmlhttp.responseText.split('\n');
                    for (var i = 0; i < lines.length; i++) {
                        var splitted = lines[i].split(' ');
                        var obj = {
                            name: splitted[0],
                            latitude: splitted[1],
                            longitude: splitted[2]
                        };
                        cities.push(obj);
                    }

                }
            }
            xmlhttp.open("GET", 'http://localhost:63342/find_place/assets/cities.txt', true);
            xmlhttp.send();
        }

        function find(name) {
            var result = [];
            for (var i = 0; i < cities.length; i++) {
                if (cities[i].name == name) {
                    result.push(cities[i]);
                }
            }
            return result;
        }

        function show(latitude, longitude) {
            var c = convertToScreen(latitude, longitude);
            document.getElementById('id-pointer').style.top = c.y + 'px';
            document.getElementById('id-pointer').style.left = c.x + 'px';
        }

        /**
         *
         * @param latitude - широта [-90..90] (будем переводить в y на карте)
         * @param longitude - долгота [-180..180] (будем переводить в x на карте)
         */
        function convertToScreen(latitude, longitude) {
            var x, y = 0;
            latitude+=90;
            y = mapHeight-(latitude*mapHeight)/180;

            longitude+=180;
            x = (longitude*mapWidth)/360;
            return {x:x,y:y};
        }

        function loadCities(url) {
            var xmlhttp = new XMLHttpRequest();
            xmlhttp.onreadystatechange = function()
            {
                if (xmlhttp.readyState==4 && xmlhttp.status==200)
                {
                    var lines = xmlhttp.responseText.split('\n');
                    var cities = '';
                    for (var i = 0; i < lines.length; i++) {
                        if (lines[i]) {
                            // выбрать широту и долготу
                            var m = lines[i].match(/([-|\d|\.]+)\t([-|\d|\.]+)/);
                            // имя
                            var n = lines[i].match(/[\d]+\t([\w|\u0020]+)/);
                            // локейшн
                            var l = lines[i].match(/([\w]+\/[\w]+)/);
                            if (m[1] && m[2] && n[1] && l[1]) {
                                cities += (n[1] + ' ' + m[1] + ' ' + m[2] + ' ' + l[1] + '\n');
                            }
                        }
                    }
                    console.log(cities);
                }
            }
            xmlhttp.open("GET", 'http://localhost:63342/find_place/assets/cities15000.txt', true);
            xmlhttp.send();
        }

        init();
    </script>
</body>
</html>